<!DOCTYPE html>
<html lang="es" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Ranking - EcoCycling</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!--ICONS-->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous"/>
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css"/>

    <!--JQUERY-->
    <script src="assets/js/jquery-3.3.1.min.js" charset="utf-8"></script>



    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" ></script>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"/>

    <script type="text/javascript" src="http://beneposto.pl/jqueryrotate/js/jQueryRotateCompressed.js"></script>
    <link href="assets/css/estilos.css" rel="stylesheet" type="text/css"/>
		<link href="assets/css/navegador.css" rel="stylesheet" type="text/css"/>
		<link href="assets/css/footer.css" rel="stylesheet" type="text/css"/>
    <link href="assets/css/rankingStyle.css" rel="stylesheet" type="text/css"/>

    <!--TABLES-->
    <!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script> -->

  </head>
  <body>
    <script type="text/javascript">
    $(document).ready( () => {

      let d = new Date();
      let d2 = new Date(d.getFullYear(),d.getMonth()-1,1,0,0,0).getTime()/1000,
          d3 = new Date(d.getFullYear(),d.getMonth(),0,23,59,59).getTime()/1000;
          month = new Array();
            month[0] = "Enero";
            month[1] = "Febrero";
            month[2] = "Marzo";
            month[3] = "Abril";
            month[4] = "Mayo";
            month[5] = "Junio";
            month[6] = "Julio";
            month[7] = "Agosto";
            month[8] = "Septiembre";
            month[9] = "Octobre";
            month[10] = "Noviembre";
            month[11] = "Diciembre";

      $.ajax({
        method: "GET",
        url: "assets/php/json/sessionCheck.json.php",
        success: function(response) {
          response = JSON.parse(response);
          if (response.error) {
            window.location.replace("index.html");
					} else {

          }
        },
        complete: function() {
          $("#btn_history").trigger("click");
        }
      })

      function ajaxRanking (button) {
          $.ajax({
              method: "GET",
              url: "assets/php/json/getRanking.json.php",
              data: { btn: button,dataIni: d2,dataFin: d3 },
              success: function (result) {
                  result = JSON.parse(result);
                  let options = ``;
                  for (let i = 0; i < result.length; i++) {
                    options += `<tr>
                      <th scope="row" class="rowIndex">${i+1}</th>
                      <td>${result[i].user}</td>
                      <td>${result[i].km} km</td>
                      <td>${result[i].nivel}</td>
                    </tr>`;
                  }
                  $("#rowsContainer").html(options);

             },
             complete: function() {
                $(".monthPrinter").html(`Resultados del mes: ${month[d.getMonth()]}`);

             }
          });
      }

      $("#btn_lastMonth").on("click",() => {
        $("#btn_lastMonth").addClass("btn-active");
        $("#btn_history").removeClass("btn-active");
        ajaxRanking($("#btn_lastMonth").val());
      });

      $("#btn_history").on("click",() => {
        $("#btn_history").addClass("btn-active");
        $("#btn_lastMonth").removeClass("btn-active");
        ajaxRanking($("#btn_history").val());
      });

      $("#rotar").mouseenter(function(){
          $(this).rotate({
              angle: 0,
              animateTo:360
            });
        });
      $(".navbar-brand").css("cursor","default");
      $(".navbar-brand").on("click", function () {
        event.preventDefault();
      });
    });

    </script>

    <header>
			<nav class="navbar navbar-default navbar-fixed-top">
				<div class="container">
					<div class="navbar-header" >
						<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						</button>

						<a class="navbar-brand" href="#"><img class="navbar-img" src="assets/img/isologoHead.png"></a>

					</div>
					<div class="collapse navbar-collapse" id="myNavbar">
						<ul class="nav navbar-nav">
							<li class=""><a href="main.html"><i class="fas fa-home"></i> Home</a></li>
							<li class="active"><a href="#"><i class="fas fa-medal"></i> Ranking</a></li>
							<li class=""><a href="donaciones.html"><i class="fas fa-hand-holding-usd"></i> Donaciones</a></li>
						</ul>
						<ul class="nav navbar-nav navbar-right">
							<li id="li-link-nombre-usuario"><a href="perfil.html"><i class="fas fa-user"></i><span id="username"> Perfil</span></a></li>
							<li><a href="assets/php/logout.proc.php"><i class="fas fa-sign-out-alt"></i> Cerrar sesion</a></li>
						</ul>
					</div>
				</div>
			</nav>
		</header>

    <section>
    <div class="container">
      <div class="row">
        <h1>Ranking</h1>
          <div class="col"></div>
          <div class="col-12 table-responsive">
            <div class="btnContainer">
              <button type="button" class="btn btn-success btn_options btn-active" id="btn_lastMonth" value="1">Top 10 Último mes</button>
              <button type="button" class="btn btn-success btn_options" id="btn_history" value="2">Top 10 del mundo</button>
            </div>

            <table class="table table-striped table-bordered table-sm .table-condensed tblRanking">
              <caption class="monthPrinter">Top 10</caption>
                <thead class="thead-dark">
                  <tr>
                    <th scope="col">#</th>
                    <th scope="col">Nombre de usuario</th>
                    <th scope="col">Kilómetros</th>
                    <th scope="col">Nivel de usuario</th>
                  </tr>
                </thead>
                <tbody id="rowsContainer"></tbody>
                </table>

          </div>
          <div class="col"></div>
      </div>
    </div></section>

    <footer class="footer">
			<div class="container">

				<div class="row text-center" id="rowFooter">
					<div class="col-md-2">
						<div class="col-md-12">
							<img class="img-isotipo-footer" src="assets/img/isotipoFooter.png" id="rotar"> <!-- isotipo es la imagen -->
						</div>
						<div class="col-md-12">
							<img class="img-logotipo-footer" src="assets/img/logotipoFooter.png"> <!-- logotipo son las letras -->
						</div>
					</div>

					<div class="col-md-8">
						<p class="text-muted">Dani Alvarez | Manuel Carceller | Erix Mamani | Adrian Canals | Alejandro Reñones</p>
						<p class="text-muted">© 1996-2019, EcoCycling.com, Inc. o afiliados. Todos los derechos reservados.</p>
					</div>

					<div class="col-md-2">
						<a href="#" class="a-icon-socialNetworks twitter"><i class="fa fa-twitter"></i></a>
						<a href="#" class="a-icon-socialNetworks facebook"><i class="fa fa-facebook"></i></a>
						<a href="#" class="a-icon-socialNetworks google"><i class="fa fa-google-plus"></i></a>
					</div>
				</div>
			</div>

		</footer>

  </body>
</html>
